image: node:20-bullseye

pipelines:
  default:
    - step:
        name: Lint & BRIEF gate
        caches:
          - node
        script:
          - npm i -g markdownlint-cli2 markdown-link-check
          - markdownlint-cli2 **/*.md --config .markdownlint.jsonc
          - for f in $(git ls-files '*.md'); do markdown-link-check -p -c mlc_config.json "$f"; done
          - apt-get update && apt-get install -y curl tar
          - VALE_VERSION=3.7.1
          - curl -fsSL -o vale.tar.gz https://github.com/errata-ai/vale/releases/download/v${VALE_VERSION}/vale_${VALE_VERSION}_Linux_64-bit.tar.gz
          - tar -xzf vale.tar.gz
          - ./vale --version
          - ./vale **/*.md
          - bash scripts/brief/check-brief.sh
