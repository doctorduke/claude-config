trigger:
  branches:
    include:
      - main
      - '*'
pool:
  vmImage: ubuntu-latest

steps:
  - checkout: self

  - task: NodeTool@0
    inputs:
      versionSpec: '20.x'

  - script: npx markdownlint-cli2 **/*.md --config .markdownlint.jsonc
    displayName: 'Markdownlint'

  - script: |
      set -e
      npm i -g markdown-link-check
      for f in $(git ls-files '*.md'); do
        markdown-link-check -p -c mlc_config.json "$f"
      done
    displayName: 'Markdown link check'

  - script: |
      set -e
      VALE_VERSION=3.7.1
      curl -fsSL -o vale.tar.gz https://github.com/errata-ai/vale/releases/download/v${VALE_VERSION}/vale_${VALE_VERSION}_Linux_64-bit.tar.gz
      tar -xzf vale.tar.gz
      ./vale --version
      ./vale **/*.md
    displayName: 'Vale Linter'

  - script: bash scripts/brief/check-brief.sh
    displayName: 'BRIEF hard gate'
