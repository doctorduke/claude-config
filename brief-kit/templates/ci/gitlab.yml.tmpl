stages: [lint, brief]

image: node:20-bullseye

variables:
  VALE_VERSION: "3.7.1"

markdownlint:
  stage: lint
  script:
    - npx --yes markdownlint-cli2 **/*.md --config .markdownlint.jsonc

linkcheck:
  stage: lint
  script:
    - npx --yes markdown-link-check -p -c mlc_config.json $(git ls-files '*.md')

vale:
  stage: lint
  image: debian:stable-slim
  before_script:
    - apt-get update && apt-get install -y curl tar
    - curl -fsSL -o vale.tar.gz https://github.com/errata-ai/vale/releases/download/v${VALE_VERSION}/vale_${VALE_VERSION}_Linux_64-bit.tar.gz
    - tar -xzf vale.tar.gz -C /usr/local/bin vale
  script:
    - /usr/local/bin/vale --version
    - /usr/local/bin/vale **/*.md

brief_gate:
  stage: brief
  script:
    - bash scripts/brief/check-brief.sh
