{
  "version": "1.0.0",
  "last_updated": "2025-10-17",
  "description": "Security policy configuration for self-hosted GitHub Actions runners",
  "compliance": ["SOC2", "ISO27001", "OWASP"],

  "authentication": {
    "pat_configuration": {
      "minimum_scopes": ["repo", "workflow"],
      "maximum_scopes": ["repo", "workflow", "read:org"],
      "forbidden_scopes": ["admin:org", "delete_repo", "admin:public_key"],
      "rotation_period_days": 90,
      "warning_threshold_days": 7,
      "critical_threshold_days": 3,
      "minimum_length": 40,
      "allowed_formats": [
        "^ghp_[a-zA-Z0-9]{36}$",
        "^github_pat_[a-zA-Z0-9]{22}_[a-zA-Z0-9]{59}$"
      ]
    },
    "github_token": {
      "default_permissions": "read",
      "allowed_permissions": {
        "actions": "read",
        "contents": "read",
        "deployments": "read",
        "issues": "write",
        "metadata": "read",
        "packages": "read",
        "pull-requests": "write",
        "statuses": "write"
      },
      "forbidden_permissions": {
        "administration": "never",
        "organization_administration": "never"
      }
    },
    "runner_tokens": {
      "type": "registration_token",
      "expiry_minutes": 60,
      "auto_refresh": true,
      "storage": "encrypted_file",
      "rotation_on_use": true
    }
  },

  "secrets_management": {
    "organization_secrets": {
      "required": [
        {
          "name": "AI_API_KEY",
          "description": "API key for AI service integration",
          "visibility": "all",
          "rotation_period_days": 180,
          "validation_regex": "^[a-zA-Z0-9-_]{20,}$"
        },
        {
          "name": "BOT_PAT",
          "description": "Bot account PAT for branch protection bypass",
          "visibility": "all",
          "rotation_period_days": 90,
          "validation_regex": "^(ghp_[a-zA-Z0-9]{36}|github_pat_[a-zA-Z0-9]{22}_[a-zA-Z0-9]{59})$"
        }
      ],
      "optional": [
        {
          "name": "SLACK_WEBHOOK_URL",
          "description": "Slack webhook for notifications",
          "visibility": "selected",
          "rotation_period_days": 365
        },
        {
          "name": "MONITORING_API_KEY",
          "description": "API key for monitoring service",
          "visibility": "all",
          "rotation_period_days": 180
        }
      ]
    },
    "repository_secrets": {
      "inheritance": "organization_first",
      "allow_override": false,
      "audit_changes": true
    },
    "storage": {
      "encryption": "AES-256-GCM",
      "key_derivation": "PBKDF2",
      "at_rest_encryption": true,
      "in_transit_encryption": "TLS 1.3"
    }
  },

  "access_control": {
    "runner_groups": {
      "default_visibility": "selected",
      "access_review_period_days": 30,
      "require_approval_for_public_repos": true,
      "allowed_repository_access": [
        "private",
        "internal"
      ]
    },
    "workflow_permissions": {
      "default_permissions": "read",
      "pull_request_approval_required": true,
      "fork_pull_request_approval": "always",
      "first_time_contributor_approval": true
    },
    "rbac_matrix": {
      "organization_owner": {
        "can_manage_runners": true,
        "can_manage_secrets": true,
        "can_view_audit_logs": true,
        "can_rotate_tokens": true
      },
      "repository_admin": {
        "can_manage_runners": false,
        "can_manage_secrets": true,
        "can_view_audit_logs": true,
        "can_rotate_tokens": false
      },
      "developer": {
        "can_manage_runners": false,
        "can_manage_secrets": false,
        "can_view_audit_logs": false,
        "can_rotate_tokens": false
      }
    }
  },

  "security_validations": {
    "pre_execution": [
      {
        "name": "secret_scanning",
        "enabled": true,
        "patterns": [
          "ghp_[a-zA-Z0-9]{36}",
          "github_pat_[a-zA-Z0-9]{22}_[a-zA-Z0-9]{59}",
          "sk-[a-zA-Z0-9]{48}",
          "-----BEGIN RSA PRIVATE KEY-----"
        ],
        "action": "block"
      },
      {
        "name": "dependency_scanning",
        "enabled": true,
        "severity_threshold": "high",
        "action": "warn"
      }
    ],
    "runtime": [
      {
        "name": "network_isolation",
        "enabled": true,
        "allowed_domains": [
          "github.com",
          "api.github.com",
          "*.actions.githubusercontent.com",
          "*.githubapp.com"
        ]
      },
      {
        "name": "resource_limits",
        "enabled": true,
        "max_cpu_percent": 80,
        "max_memory_gb": 16,
        "max_disk_gb": 100,
        "max_runtime_minutes": 360
      }
    ],
    "post_execution": [
      {
        "name": "log_sanitization",
        "enabled": true,
        "remove_secrets": true,
        "mask_patterns": [
          "password",
          "token",
          "secret",
          "key",
          "credential"
        ]
      },
      {
        "name": "artifact_scanning",
        "enabled": true,
        "scan_for_secrets": true,
        "scan_for_vulnerabilities": true
      }
    ]
  },

  "audit_logging": {
    "enabled": true,
    "retention_days": 90,
    "events_to_log": [
      "runner_registration",
      "runner_deregistration",
      "secret_access",
      "secret_modification",
      "token_generation",
      "token_rotation",
      "workflow_execution",
      "permission_change"
    ],
    "log_destinations": [
      {
        "type": "local_file",
        "path": "/var/log/github-actions-audit.log",
        "rotation": "daily",
        "compression": true
      },
      {
        "type": "syslog",
        "enabled": false,
        "server": "syslog.example.com",
        "port": 514,
        "protocol": "TCP"
      }
    ],
    "alerting": {
      "enabled": true,
      "alert_on": [
        "unauthorized_access",
        "secret_leak_detected",
        "token_expiry_warning",
        "suspicious_activity"
      ],
      "notification_channels": [
        "email",
        "slack"
      ]
    }
  },

  "network_security": {
    "tls_configuration": {
      "minimum_version": "1.2",
      "preferred_version": "1.3",
      "cipher_suites": [
        "TLS_AES_256_GCM_SHA384",
        "TLS_CHACHA20_POLY1305_SHA256",
        "TLS_AES_128_GCM_SHA256"
      ]
    },
    "firewall_rules": {
      "default_policy": "deny",
      "outbound_allowed": [
        {
          "destination": "github.com",
          "ports": [443],
          "protocol": "HTTPS"
        },
        {
          "destination": "api.github.com",
          "ports": [443],
          "protocol": "HTTPS"
        },
        {
          "destination": "*.actions.githubusercontent.com",
          "ports": [443],
          "protocol": "HTTPS"
        }
      ],
      "inbound_allowed": []
    },
    "proxy_configuration": {
      "supported": true,
      "authentication_required": true,
      "bypass_list": [
        "localhost",
        "127.0.0.1",
        "*.internal.company.com"
      ]
    }
  },

  "compliance": {
    "standards": {
      "soc2": {
        "enabled": true,
        "controls": [
          "CC6.1", "CC6.2", "CC6.3",
          "CC7.1", "CC7.2"
        ]
      },
      "iso27001": {
        "enabled": true,
        "controls": [
          "A.9.1.1", "A.9.1.2", "A.9.2.1",
          "A.12.1.1", "A.12.1.2"
        ]
      },
      "owasp": {
        "enabled": true,
        "top10_controls": [
          "A01:2021", "A02:2021", "A03:2021",
          "A04:2021", "A05:2021", "A07:2021"
        ]
      }
    },
    "reporting": {
      "frequency": "monthly",
      "format": "JSON",
      "recipients": ["security-team@company.com"]
    }
  },

  "incident_response": {
    "enabled": true,
    "severity_levels": {
      "critical": {
        "description": "Secret leak or unauthorized access",
        "response_time_minutes": 15,
        "escalation_required": true
      },
      "high": {
        "description": "Token expiry or permission violation",
        "response_time_minutes": 60,
        "escalation_required": false
      },
      "medium": {
        "description": "Configuration drift or policy violation",
        "response_time_minutes": 240,
        "escalation_required": false
      },
      "low": {
        "description": "Informational or minor issues",
        "response_time_minutes": 1440,
        "escalation_required": false
      }
    },
    "playbooks": {
      "secret_leak": {
        "steps": [
          "Immediately rotate affected secret",
          "Audit access logs for unauthorized use",
          "Update secret in all dependent systems",
          "Conduct root cause analysis",
          "Update security controls to prevent recurrence"
        ]
      },
      "unauthorized_access": {
        "steps": [
          "Revoke access immediately",
          "Review audit logs for actions taken",
          "Assess impact and data exposure",
          "Reset all potentially affected credentials",
          "Implement additional access controls"
        ]
      }
    }
  },

  "windows_wsl_specific": {
    "wsl_security": {
      "use_wsl2": true,
      "enable_windows_defender": true,
      "file_system_isolation": true,
      "network_isolation": false
    },
    "windows_security": {
      "require_bitlocker": true,
      "enable_secure_boot": true,
      "enable_credential_guard": true,
      "disable_llmnr": true,
      "disable_netbios": true
    },
    "cross_platform_considerations": {
      "path_handling": "use_forward_slashes",
      "line_endings": "LF",
      "file_permissions": "preserve_execute_bit"
    }
  },

  "security_headers": {
    "required_headers": {
      "Strict-Transport-Security": "max-age=31536000; includeSubDomains; preload",
      "X-Content-Type-Options": "nosniff",
      "X-Frame-Options": "DENY",
      "X-XSS-Protection": "1; mode=block",
      "Content-Security-Policy": "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'"
    }
  },

  "token_vs_pat_decision_matrix": {
    "use_github_token_when": [
      "Workflow needs to access only current repository",
      "Read-only operations on public repositories",
      "Creating issues or pull request comments",
      "Updating check runs or deployment status",
      "No cross-repository access needed"
    ],
    "use_pat_when": [
      "Cross-repository access required",
      "Organization-level operations needed",
      "Bypassing branch protection rules",
      "Creating or deleting repositories",
      "Managing organization secrets",
      "Accessing private repositories from forked PRs"
    ],
    "security_comparison": {
      "github_token": {
        "pros": [
          "Automatically scoped to repository",
          "Short-lived (job duration)",
          "No manual rotation needed",
          "Automatically revoked after job"
        ],
        "cons": [
          "Limited to repository scope",
          "Cannot bypass branch protection",
          "Not available in untrusted contexts"
        ]
      },
      "personal_access_token": {
        "pros": [
          "Cross-repository access",
          "Persistent across jobs",
          "Can bypass branch protection",
          "Organization-wide operations"
        ],
        "cons": [
          "Requires manual rotation",
          "Broader scope increases risk",
          "Manual revocation needed",
          "Subject to rate limits per user"
        ]
      }
    }
  }
}